<!doctype html>
<html>
  <head>
	<link rel="stylesheet" href="editor.css">
	<script src="jquery-3.6.3.min.js"></script>
    <script src="retro.core.js"></script>
	<script src="retro.gfx.js"></script>
	<script src="retro.input.js"></script>
	<script src="retro.component.js"></script>
	<script src="retro.system.js"></script>
	<script src="retro.blueprint.js"></script>
	<script src="retro.entity.js"></script>
	<script src="retro.map.js"></script>
	<script src="retro.roguelike.js"></script>
	<script src='astar.js'></script>
  </head>
  <body style="background:#222323;" onload="InitGame(); LoadMaps();">
	<div style="float: left;">
		<canvas id="canvas" style="width: 512px; height: 512px; image-rendering: pixelated; background:#222323;"></canvas>
		<button onclick="SaveMap()" style="display: block;">Save</button>
	</div>

	<div id="tabs" style="float: right; display:inline;">
		<button onclick="LoadMaps()">Maps</button>
		<button onclick="LoadTiles()">Tiles</button>
	</div>
	<br><br><br>
	<div id="content" style="float: right; display:grid;"></div>
	<script>
		function SetMap(name)
		{
			$.get(
				"http://roguelite.de/rpg/get_row.php",
				{table: "Maps", filter: "Name", name: name},
				function(data)
				{
					let serverMap = data.Data.split('');;

					SetMapData(serverMap);
				},
				"json"
			);
		}

		function LoadMaps()
		{
			$.get(
				"http://roguelite.de/rpg/get_list.php",
				{table: "Maps", col: ["Name", "ID"]},
				function(data)
				{
					$("#content").empty();
					data.forEach((element) => {
						$("#content").append("<button onclick=SetMap('" + element[0] + "');>" + element[0] + "</button>");
					});
				},
				"json"
			);
		}

		function LoadTiles()
		{
			$.get(
				"http://roguelite.de/rpg/get_list.php",
				{table: "Tiles", col: ["Name", "Symbol"]},
				function(data)
				{
					$("#content").empty();
					data.forEach((element) => {
						$("#content")
							.append("<button title=" + element[1] + ">" + element[0] + "</button>")
							.click(function(button){GetEntity('Editor').Editor.selection = button.target.title;})
					});
				},
				"json"
			);
		}

		function SaveMap()
		{
			$.get(
				"http://roguelite.de/rpg/set_row.php",
				{table: "Maps", filter: "Name", name: "RPG", data: {Data: GetMapData()}},
				function(data)
				{
					console.log(data);
				},
				"json"
			);
		}
	</script>
  </body>
</html>